<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex,nofollow" />
    <title>Forgot Password | Tour Guide</title>

    <!-- Use your existing Tailwind build + styles to match the site -->
    <link href="../output.css" rel="stylesheet" />
    <link rel="stylesheet" href="../css/styles.css" />
  </head>
  <body class="relative min-h-screen overflow-x-hidden">
    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Background -->
    <div class="absolute inset-0">
      <img
        src="../img/sign in background.png"
        class="w-full h-full object-cover blur-xl"
        alt="blurred background"
      />
    </div>
    <img
      src="../img/sign in background.png"
      class="absolute inset-0 w-full h-full bg-img transition-opacity duration-700 opacity-0"
      loading="lazy"
      onload="this.style.opacity=1"
      alt="background image"
    />

    <!-- Page content -->
    <div
      class="relative z-10 flex items-center justify-center min-h-screen px-4 bg-black/40"
    >
      <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
        <div class="p-4 flex items-center justify-center">
          <img src="../img/Vector.png" alt="main logo" class="h-10" />
        </div>

        <h1 class="text-2xl font-bold text-center text-gray-800">
          Forgot your password?
        </h1>
        <p class="mt-2 text-center text-gray-500 text-sm">
          Enter your email and we’ll send you a reset link.
        </p>

        <!-- Form -->
        <form id="resetForm" class="mt-6 space-y-4" novalidate>
          <div>
            <label class="block text-sm text-gray-600 mb-1" for="email"
              >Email</label
            >
            <input
              id="email"
              type="email"
              placeholder="you@example.com"
              autocomplete="email"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:outline-none"
              required
            />
          </div>

          <button
            type="submit"
            id="submitBtn"
            class="w-full bg-yellow-400 text-white font-semibold py-2 rounded-lg shadow-md hover:bg-yellow-500 transition disabled:opacity-60 disabled:cursor-not-allowed"
          >
            Send Reset Link
          </button>

          <p class="text-center text-sm text-gray-500">
            Remembered it?
            <a href="sign-in.html" class="text-yellow-600 hover:underline"
              >Back to sign in</a
            >
          </p>

          <p class="text-xs text-gray-400 text-center mt-2">
            Tip: Check your spam/junk folder if you don’t see the email.
          </p>
        </form>

        <p class="text-center text-xs text-gray-400 mt-6">
          © 2025 Tour Guide. All rights reserved.
        </p>
      </div>
    </div>

    <!-- Script -->
    <script>
      // Lightweight toast (uses your global showToast if present)
      function toast(message, type = "success") {
        if (window.showToast) {
          return showToast(message, type);
        }
        const wrap = document.getElementById("toast-container");
        const toast = document.createElement("div");
        toast.className = `
        max-w-sm w-full px-4 py-3 rounded-lg shadow-lg text-white transition
        ${type === "success" ? "bg-green-600" : "bg-red-600"}
      `;
        toast.textContent = message;
        wrap.appendChild(toast);
        setTimeout(() => {
          toast.style.opacity = "0";
          toast.style.transform = "translateY(-4px)";
          toast.addEventListener("transitionend", () => toast.remove());
        }, 3500);
      }

      (function () {
        const form = document.getElementById("resetForm");
        const emailInput = document.getElementById("email");
        const submitBtn = document.getElementById("submitBtn");

        // Small cooldown to avoid spam (30s)
        let cooldownTimer = null;
        function startCooldown(seconds = 30) {
          let remain = seconds;
          submitBtn.disabled = true;
          const original = submitBtn.textContent;
          submitBtn.textContent = `Resend in ${remain}s`;
          cooldownTimer = setInterval(() => {
            remain -= 1;
            if (remain <= 0) {
              clearInterval(cooldownTimer);
              submitBtn.disabled = false;
              submitBtn.textContent = original;
            } else {
              submitBtn.textContent = `Resend in ${remain}s`;
            }
          }, 1000);
        }

        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          const email = (emailInput.value || "").trim();
          if (!email) {
            emailInput.focus();
            return toast("Please enter your email.", "error");
          }

          // Basic client-side email sanity check
          const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
          if (!emailOk) {
            emailInput.focus();
            return toast("Please enter a valid email address.", "error");
          }

          const original = submitBtn.textContent;
          submitBtn.disabled = true;
          submitBtn.textContent = "Sending…";

          try {
            const res = await fetch("/api/Auth/ForgetPassword", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email }),
            });

            let data = {};
            try {
              data = await res.json();
            } catch {}

            if (res.ok) {
              // Security-friendly: never reveal whether an email exists
              toast(
                "If an account exists for that email, a reset link has been sent.",
                "success"
              );
              form.reset();
              startCooldown(30);
            } else {
              toast(
                data?.errors?.join(", ") || "Couldn't send reset link.",
                "error"
              );
              submitBtn.disabled = false;
              submitBtn.textContent = original;
            }
          } catch (err) {
            console.error(err);
            toast("Network error. Please try again.", "error");
            submitBtn.disabled = false;
            submitBtn.textContent = original;
          }
        });
      })();
    </script>
  </body>
</html>
