<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Account | Tour Guide</title>
    <link href="../output.css" rel="stylesheet" />
    <link rel="stylesheet" href="../css/styles.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body class="relative h-screen overflow-x-hidden overflow-y-auto">
    <!-- ‚úÖ Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- üî∏ Blurred Placeholder -->
    <div class="absolute inset-0">
      <img
        src="../img/sign in background.png"
        class="w-full h-full object-cover blur-xl"
        alt="blurred beach placeholder"
      />
    </div>

    <!-- üî∏ Full Image -->
    <img
      src="../img/sign in background.png"
      class="absolute inset-0 w-full h-full bg-img transition-opacity duration-700 opacity-0"
      loading="lazy"
      onload="this.style.opacity=1"
      alt="background beach"
    />

    <!-- üî∏ Content Container -->
    <div
      class="relative z-10 flex items-center justify-center h-screen px-4 bg-black/40"
    >
      <div
        class="bg-white rounded-2xl shadow-xl p-7 sm:p-7 md:p-7 max-w-md w-full max-h-[90vh] overflow-y-auto overflow-hidden justify-center items-center"
      >
        <div class="p-6 flex items-center justify-center">
          <img src="../img/Vector.png" alt="main logo" />
        </div>

        <!-- ‚úÖ Registration Form -->
        <form id="registerForm">
          <div class="relative min-h-[290px] sm:min-h-[290px] md:min-h-[290px]">
            <!-- Step 1 -->
            <div class="step step-active" data-step="1">
              <div class="space-y-4">
                <div>
                  <label
                    for="name"
                    class="block text-sm font-medium text-gray-600"
                    >Full Name</label
                  >
                  <input
                    id="name"
                    name="FullName"
                    type="text"
                    placeholder="Jane Doe"
                    class="w-full mt-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 placeholder:italic placeholder-black/50"
                    required
                  />
                </div>

                <div>
                  <label
                    for="country"
                    class="block text-sm font-medium text-gray-600"
                    >Country</label
                  >
                  <select
                    id="country"
                    name="Country"
                    required
                    class="w-full mt-1 px-2 py-1 bg-white text-sm focus:outline-none"
                  >
                    <option value="">Select Country</option>
                  </select>
                </div>

                <div>
                  <label
                    for="phone"
                    class="block text-sm font-medium text-gray-600"
                    >Phone Number</label
                  >
                  <input
                    id="phone"
                    name="PhoneNumber"
                    type="text"
                    placeholder="+1234567890"
                    class="w-full mt-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 placeholder:italic placeholder-black/50"
                    required
                  />
                </div>
              </div>

              <div class="flex justify-end pt-4">
                <button
                  type="button"
                  class="next-step bg-yellow-400 text-white font-semibold py-2 px-6 rounded-lg hover:bg-yellow-500"
                >
                  Next
                </button>
              </div>
            </div>

            <!-- Step 2 -->
            <div class="step step-hidden" data-step="2">
              <div class="space-y-4">
                <div>
                  <label
                    for="email"
                    class="block text-sm font-medium text-gray-600"
                    >Email</label
                  >
                  <input
                    id="email"
                    name="Email"
                    type="email"
                    placeholder="you@example.com"
                    class="w-full mt-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 placeholder:italic placeholder-black/50"
                    required
                  />
                </div>

                <div class="relative">
                  <label
                    for="password"
                    class="block text-sm font-medium text-gray-600"
                    >Password</label
                  >
                  <input
                    id="password"
                    name="Password"
                    type="password"
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    class="w-full mt-1 px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 placeholder:italic placeholder-black/50"
                    required
                  />
                  <button
                    title="Password"
                    type="button"
                    onclick="togglePassword('password', this)"
                    class="absolute right-3 top-9 text-gray-500 hover:text-gray-700"
                    tabindex="-1"
                  >
                    <i class="fa-solid fa-eye"></i>
                  </button>
                </div>

                <div class="relative">
                  <label
                    for="confirm-password"
                    class="block text-sm font-medium text-gray-600"
                    >Confirm Password</label
                  >
                  <input
                    id="confirm-password"
                    type="password"
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    class="w-full mt-1 px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 placeholder:italic placeholder-black/50"
                    required
                  />
                  <button
                    title="Confirm password"
                    type="button"
                    onclick="togglePassword('confirm-password', this)"
                    class="absolute right-3 top-9 text-gray-500 hover:text-gray-700"
                    tabindex="-1"
                  >
                    <i class="fa-solid fa-eye"></i>
                  </button>
                </div>
              </div>

              <div class="flex justify-between pt-4">
                <button
                  type="button"
                  class="prev-step text-gray-600 hover:underline"
                >
                  ‚Üê Back
                </button>
                <button
                  type="submit"
                  class="bg-yellow-400 text-white font-semibold py-2 px-6 rounded-lg hover:bg-yellow-500"
                >
                  Create Account
                </button>
              </div>
            </div>
          </div>
        </form>

        <!-- Divider -->
        <div class="relative my-3">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-gray-300"></div>
          </div>
          <div class="relative flex justify-center text-sm">
            <span class="px-2 bg-white text-gray-500">Or continue with</span>
          </div>
        </div>

        <!-- Google Sign-up -->
        <a
          href="/api/ExternalAuth/google-redirect-login"
          class="w-full flex items-center justify-center gap-2 bg-white border border-gray-300 rounded-lg py-2 px-4 shadow-sm hover:bg-gray-50 transition no-underline"
        >
          <img
            src="https://www.google.com/favicon.ico"
            alt="Google logo"
            class="w-5 h-5"
          />
          <span class="text-black">Sign up with Google</span>
        </a>

        <p class="text-center text-xs text-gray-400 mt-4">
          Already have an account?
          <a href="sign-in.html" class="text-yellow-500 hover:underline"
            >Sign in</a
          >
        </p>
      </div>
    </div>

    <!-- ‚úÖ JS to Submit FormData and Show Toasts Based on Status -->
    <script>
      const countrySelect = document.getElementById("country");
      const countries = [
        "Afghanistan",
        "Albania",
        "Algeria",
        "Argentina",
        "Australia",
        "Austria",
        "Bahrain",
        "Bangladesh",
        "Belgium",
        "Brazil",
        "Canada",
        "Chile",
        "China",
        "Colombia",
        "Denmark",
        "Egypt",
        "Finland",
        "France",
        "Germany",
        "Greece",
        "India",
        "Indonesia",
        "Iran",
        "Iraq",
        "Ireland",
        "Israel",
        "Italy",
        "Japan",
        "Jordan",
        "Kenya",
        "Kuwait",
        "Lebanon",
        "Libya",
        "Malaysia",
        "Mexico",
        "Morocco",
        "Netherlands",
        "New Zealand",
        "Nigeria",
        "Norway",
        "Oman",
        "Pakistan",
        "Peru",
        "Philippines",
        "Poland",
        "Portugal",
        "Qatar",
        "Romania",
        "Russia",
        "Saudi Arabia",
        "Singapore",
        "South Africa",
        "South Korea",
        "Spain",
        "Sri Lanka",
        "Sudan",
        "Sweden",
        "Switzerland",
        "Syria",
        "Thailand",
        "Tunisia",
        "Turkey",
        "UAE",
        "UK",
        "USA",
        "Ukraine",
        "Uzbekistan",
        "Venezuela",
        "Vietnam",
        "Yemen",
        "Zimbabwe",
      ];

      countries.forEach((country) => {
        const option = document.createElement("option");
        option.value = country;
        option.textContent = country;
        countrySelect.appendChild(option);
      });
      new TomSelect("#country", {
        create: false,
        sortField: "text",
        placeholder: "Select a country...",
      });

      function showToast(message, type = "success") {
        const toastContainer = document.getElementById("toast-container");
        const toast = document.createElement("div");
        toast.className = `
          max-w-sm w-full px-4 py-3 rounded-lg shadow-lg text-white animate-fade-in-up transition
          ${type === "success" ? "bg-green-600" : "bg-red-600"}
        `;
        toast.textContent = message;
        toastContainer.appendChild(toast);
        setTimeout(() => {
          toast.classList.add("opacity-0", "translate-y-2");
          toast.addEventListener("transitionend", () => toast.remove());
        }, 5000);
      }

      document
        .getElementById("registerForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const form = e.target;
          const password = form.Password.value;
          const confirmPassword =
            document.getElementById("confirm-password").value;

          if (password !== confirmPassword) {
            showToast("Passwords do not match!", "error");
            return;
          }

          const formData = new FormData();
          formData.append("Email", form.Email.value);
          formData.append("FullName", form.FullName.value);
          formData.append("Country", form.Country.value);
          formData.append("Password", form.Password.value);
          formData.append("PhoneNumber", form.PhoneNumber.value);

          try {
            const response = await fetch("/api/Auth/Register", {
              method: "POST",
              body: formData,
            });

            const result = await response.json();
            const toastType = result.succeeded ? "success" : "error";
            console.log(result);

            const message =
              result.errors?.join(", ") ||
              result.message ||
              (toastType === "success"
                ? "Registration successful!"
                : "Registration failed.");

            showToast(message, toastType);

            if (result.succeeded) {
              form.reset();
              window.location.href = "check-email.html";
            }
          } catch (err) {
            console.error(err);
            showToast("Network error. Please try again.", "error");
          }
        });
      function togglePassword(inputId, button) {
        const input = document.getElementById(inputId);
        const icon = button.querySelector("i");

        const isVisible = input.type === "text";
        input.type = isVisible ? "password" : "text";

        icon.classList.toggle("fa-eye");
        icon.classList.toggle("fa-eye-slash");
      }

      // Wizard Navigation
      const steps = document.querySelectorAll(".step");
      let currentStep = 0;

      function showStep(index) {
        steps.forEach((step, i) => {
          if (i === index) {
            step.classList.remove("step-hidden");
            step.classList.add("step-active");
          } else {
            step.classList.remove("step-active");
            step.classList.add("step-hidden");
          }
        });
      }

      document.querySelectorAll(".next-step").forEach((btn) => {
        btn.addEventListener("click", () => {
          const current = steps[currentStep];
          const inputs = current.querySelectorAll("input, select");
          let valid = true;

          inputs.forEach((input) => {
            if (!input.checkValidity()) {
              input.reportValidity();
              valid = false;
            }
          });

          if (valid) {
            currentStep++;
            showStep(currentStep);
          }
        });
      });

      document.querySelectorAll(".prev-step").forEach((btn) => {
        btn.addEventListener("click", () => {
          currentStep--;
          showStep(currentStep);
        });
      });

      showStep(currentStep);
    </script>

    <!-- Optional Scripts -->
    <script src="../JS/translation.js"></script>
    <script src="../JS/transition.js"></script>
  </body>
</html>
