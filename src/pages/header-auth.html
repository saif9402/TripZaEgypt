<header
  x-data="{ open: false }"
  class="fixed top-0 left-0 w-full z-20 bg-black/20 backdrop-blur-lg text-white shadow-none border-b border-white/10 px-4 py-1 flex justify-between items-center"
>
  <div class="relative flex items-center justify-start h-9 md:h-12">
    <img
      src="/img/Header.svg"
      class="h-50 object-contain -ml-9 flex items-start justify-start"
      alt="logo header"
      data-i18n-alt="header.logoAlt"
    />

    <!-- Invisible clickable overlay to Home -->
    <a
      href="/index.html"
      aria-label="Go to Home"
      title="Home"
      class="absolute inset-0 opacity-0"
    >
      <span class="sr-only">Home</span>
    </a>
  </div>

  <!-- Hamburger Icon (Mobile) -->
  <button
    @click="open = true"
    class="md:hidden text-white text-2xl"
    title="Open menu"
    aria-label="Open menu"
    data-i18n-title="aria.nav.open"
    data-i18n-aria-label="aria.nav.open"
  >
    <i class="fas fa-bars"></i>
  </button>

  <!-- Desktop Nav -->
  <nav class="hidden md:flex space-x-4 items-center">
    <a
      data-i18n="nav.home"
      href="/index.html"
      class="focus:outline-none px-3 py-1 rounded-full bg-white/20 hover:bg-white/30 transition"
      >Home</a
    >
    <a
      data-i18n="nav.about"
      href="/pages/about-us.html"
      class="focus:outline-none px-3 py-1 rounded-full bg-white/20 hover:bg-white/30 transition"
      >About Us</a
    >

    <!-- Trips dropdown -->
    <div x-data="{ openTrips: false }" class="relative">
      <button
        @click="openTrips = !openTrips"
        class="focus:outline-none px-3 py-1 rounded-full bg-white/20 hover:bg-white/30 transition"
        data-i18n="nav.trips"
      >
        Our Trips
      </button>

      <ul
        x-show="openTrips"
        x-cloak
        @click.away="openTrips = false"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 translate-y-1"
        x-transition:enter-end="opacity-100 translate-y-0"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100 translate-y-0"
        x-transition:leave-end="opacity-0 translate-y-1"
        class="absolute right-0 mt-2 w-48 bg-white text-gray-800 rounded-xl shadow-xl ring-1 ring-black/10 z-50 overflow-hidden"
        id="tripsDropdown"
      >
        <!-- 'All Trips' gets overwritten by includes.js as well, but we i18n it here for safety -->
        <li>
          <a
            href="/pages/trips-list.html"
            class="block px-4 py-2 font-semibold text-blue-600 hover:bg-blue-50"
            data-i18n="header.allTrips"
          >
            All Trips
          </a>
        </li>
        <li><hr class="border-t border-gray-200 my-1" /></li>
        <!-- Categories injected here -->
      </ul>
    </div>

    <!-- Language Dropdown -->
    <div x-data="{ langOpen: false }" class="relative">
      <button
        id="currentLang"
        @click="langOpen = !langOpen"
        class="focus:outline-none px-3 py-1 rounded-full bg-white/20 hover:bg-white/30 transition"
      >
        EN
      </button>
      <ul
        x-show="langOpen"
        x-cloak
        @click.away="langOpen = false"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 translate-y-1"
        x-transition:enter-end="opacity-100 translate-y-0"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100 translate-y-0"
        x-transition:leave-end="opacity-0 translate-y-1"
        class="absolute right-0 mt-2 w-32 bg-white text-gray-800 rounded-xl shadow-xl ring-1 ring-black/10 z-50 overflow-hidden"
      >
        <li>
          <a
            onclick="setLanguage('en')"
            class="flex items-center gap-2 px-4 py-2 hover:bg-sky-100"
            ><img src="/img/flags/en.jpeg" class="w-4 h-4" alt="English flag" />
            EN</a
          >
        </li>
        <li>
          <a
            onclick="setLanguage('deu')"
            class="flex items-center gap-2 px-4 py-2 hover:bg-sky-100"
            ><img src="/img/flags/deu.png" class="w-4 h-4" alt="German flag" />
            DEU</a
          >
        </li>
      </ul>
    </div>

    <!-- User menu -->
    <div x-data="{ userOpen: false }" class="relative">
      <button
        id="userMenuBtn"
        @click="userOpen = !userOpen"
        class="focus:outline-none w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 transition flex items-center justify-center"
        aria-haspopup="menu"
        aria-expanded="false"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5 text-white"
          viewBox="0 0 20 20"
          fill="currentColor"
          role="img"
          aria-hidden="true"
        >
          <path
            d="M10 10a4 4 0 100-8 4 4 0 000 8zm0 2c-4 0-6 2-6 4v1h12v-1c0-2-2-4-6-4z"
          />
        </svg>
      </button>
      <ul
        x-show="userOpen"
        x-cloak
        @click.away="userOpen = false"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0 translate-y-1"
        x-transition:enter-end="opacity-100 translate-y-0"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100 translate-y-0"
        x-transition:leave-end="opacity-0 translate-y-1"
        class="absolute right-0 mt-2 w-32 bg-white text-gray-800 rounded-xl shadow-xl ring-1 ring-black/10 z-50 overflow-hidden"
      >
        <li>
          <a
            href="/pages/profile.html"
            class="flex items-center gap-2 px-4 py-2 hover:bg-sky-100"
            data-i18n="nav.profile"
            >Profile</a
          >
        </li>
        <li>
          <a
            onclick="logout()"
            class="flex cursor-pointer items-center gap-2 px-4 py-2 text-red-500 hover:text-red-600 hover:bg-red-50"
            data-i18n="nav.logout"
          >
            Logout
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Overlay -->
  <div
    class="fixed inset-0 z-40 bg-black/50 backdrop-blur-sm transition-opacity"
    x-show="open"
    x-transition.opacity
    x-cloak
    @click="open = false"
    aria-hidden="true"
  ></div>

  <!-- Mobile Top Drawer -->
  <aside
    class="fixed top-0 left-0 w-full h-fit bg-white shadow-md z-50 p-6 text-black transform transition-transform"
    x-show="open"
    x-transition:enter="transform transition ease-out duration-300"
    x-transition:enter-start="-translate-y-full"
    x-transition:enter-end="translate-y-0"
    x-transition:leave="transform transition ease-in duration-300"
    x-transition:leave-start="translate-y-0"
    x-transition:leave-end="-translate-y-full"
    x-cloak
  >
    <!-- Mobile Logo -->
    <div
      class="relative inline-flex w-fit items-center justify-start h-9 md:h-12"
    >
      <img
        src="/img/Header.svg"
        class="h-50 object-contain -ml-9 flex items-start justify-start"
        alt="logo header"
        data-i18n-alt="header.logoAlt"
      />

      <!-- Invisible clickable overlay to Home (matches logo size) -->
      <a
        href="/index.html"
        aria-label="Go to Home"
        title="Home"
        class="absolute inset-0 opacity-0 focus:outline-none focus-visible:outline-none"
        tabindex="-1"
      >
        <span class="sr-only">Home</span>
      </a>
    </div>

    <button
      class="text-black text-2xl absolute top-4 right-4"
      @click="open = false"
      title="Close menu"
      aria-label="Close menu"
      data-i18n-title="aria.nav.close"
      data-i18n-aria-label="aria.nav.close"
    >
      <i class="fas fa-times"></i>
    </button>

    <nav class="mt-2 flex flex-col space-y-1">
      <a href="/index.html" class="hover:text-blue-500" data-i18n="nav.home"
        >Home</a
      >
      <a
        href="/pages/about-us.html"
        class="hover:text-blue-500"
        data-i18n="nav.about"
        >About Us</a
      >

      <div class="flex flex-col space-y-1">
        <a
          href="/pages/trips-list.html"
          class="hover:text-blue-500"
          data-i18n="nav.trips"
          >Our Trips</a
        >
        <ul class="ml-4 text-sm space-y-1" id="mobileTripsDropdown">
          <!-- Categories injected here -->
        </ul>
      </div>

      <a
        href="/pages/profile.html"
        class="hover:text-blue-500"
        data-i18n="nav.profile"
        >Profile</a
      >
      <button
        onclick="logout()"
        class="text-left text-red-600 hover:text-red-800"
        data-i18n="nav.logout"
      >
        Logout
      </button>

      <!-- Language Switcher -->
      <div x-data="{ langOpen: false }" class="relative">
        <button
          id="mobileLangBtn"
          @click="langOpen = !langOpen"
          class="mt-4 px-3 py-2 bg-gray-200 rounded text-sm flex items-center justify-between w-full"
        >
          <span>üåê <span id="mobileLangLabel">EN</span></span>
          <i class="fas fa-chevron-down ml-2" aria-hidden="true"></i>
        </button>
        <ul
          x-show="langOpen"
          x-cloak
          @click.away="langOpen = false"
          x-transition:enter="transition ease-out duration-200"
          x-transition:enter-start="opacity-0 scale-95"
          x-transition:enter-end="opacity-100 scale-100"
          x-transition:leave="transition ease-in duration-150"
          x-transition:leave-start="opacity-100 scale-100"
          x-transition:leave-end="opacity-0 scale-95"
          class="mt-2 bg-white rounded-lg shadow text-sm overflow-hidden divide-y divide-gray-100 origin-top-right"
        >
          <li>
            <a
              onclick="setLanguage('en')"
              class="block px-4 py-2 hover:bg-gray-100"
            >
              <img
                src="/img/flags/en.jpeg"
                class="inline w-4 h-4 mr-2"
                alt="English flag"
              />
              EN
            </a>
          </li>
          <li>
            <a
              onclick="setLanguage('deu')"
              class="block px-4 py-2 hover:bg-gray-100"
            >
              <img
                src="/img/flags/deu.png"
                class="inline w-4 h-4 mr-2"
                alt="German flag"
              />
              DEU
            </a>
          </li>
        </ul>
      </div>
    </nav>
  </aside>
</header>

<script>
  (function () {
    // Populate names if present (avoid errors if elements are not in this template)
    if (window.currentUser) {
      const { fullName, email } = window.currentUser;
      const el1 = document.getElementById("userName");
      const el2 = document.getElementById("mobileUserName");
      const el3 = document.getElementById("mobileUserEmail");
      if (el1) el1.textContent = fullName || window.t?.("nav.user") || "User";
      if (el2) el2.textContent = fullName || window.t?.("nav.user") || "User";
      if (el3) el3.textContent = email || "user@example.com";
    }
    // Don't redefine logout here; includes.js already defines a robust global logout()
  })();
</script>
